apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: hyperparametertuningjob-
  annotations: {pipelines.kubeflow.org/kfp_sdk_version: 1.8.9, pipelines.kubeflow.org/pipeline_compilation_time: '2022-07-28T14:36:37.549896',
    pipelines.kubeflow.org/pipeline_spec: '{"description": "SageMaker HyperParameterTuningJob
      component", "inputs": [{"default": "{\"hyperParameterTuningJobObjective\": {\"metricName\":
      \"validation:error\", \"type_\": \"Minimize\"}, \"parameterRanges\": {\"categoricalParameterRanges\":
      [], \"continuousParameterRanges\": [], \"integerParameterRanges\": [{\"maxValue\":
      \"20\", \"minValue\": \"10\", \"name\": \"num_round\", \"scalingType\": \"Linear\"}]},
      \"resourceLimits\": {\"maxNumberOfTrainingJobs\": 2, \"maxParallelTrainingJobs\":
      1}, \"strategy\": \"Bayesian\"}", "name": "hyper_parameter_tuning_job_config",
      "optional": true}, {"default": "kfp-ack-hpo-job-995182", "name": "hyper_parameter_tuning_job_name",
      "optional": true}, {"name": "tags", "optional": true}, {"default": "{\"algorithmSpecification\":
      {\"trainingImage\": \"632365934929.dkr.ecr.us-west-1.amazonaws.com/xgboost:1\",
      \"trainingInputMode\": \"File\"}, \"enableInterContainerTrafficEncryption\":
      false, \"enableNetworkIsolation\": true, \"inputDataConfig\": [{\"channelName\":
      \"train\", \"compressionType\": \"None\", \"contentType\": \"text/libsvm\",
      \"dataSource\": {\"s3DataSource\": {\"s3DataDistributionType\": \"FullyReplicated\",
      \"s3DataType\": \"S3Prefix\", \"s3URI\": \"s3://ack-sagemaker-bucket-402026529871/sagemaker/xgboost/train\"}},
      \"inputMode\": \"File\", \"recordWrapperType\": \"None\"}, {\"channelName\":
      \"validation\", \"compressionType\": \"None\", \"contentType\": \"text/libsvm\",
      \"dataSource\": {\"s3DataSource\": {\"s3DataDistributionType\": \"FullyReplicated\",
      \"s3DataType\": \"S3Prefix\", \"s3URI\": \"s3://ack-sagemaker-bucket-402026529871/sagemaker/xgboost/validation\"}},
      \"inputMode\": \"File\", \"recordWrapperType\": \"None\"}], \"outputDataConfig\":
      {\"s3OutputPath\": \"s3://ack-sagemaker-bucket-402026529871\"}, \"resourceConfig\":
      {\"instanceCount\": 1, \"instanceType\": \"ml.m4.xlarge\", \"volumeSizeInGB\":
      25}, \"roleARN\": \"arn:aws:iam::402026529871:role/ack-sagemaker-execution-role-402026529871\",
      \"staticHyperParameters\": {\"base_score\": \"0.5\", \"booster\": \"gbtree\",
      \"csv_weights\": \"0\", \"dsplit\": \"row\", \"grow_policy\": \"depthwise\",
      \"lambda_bias\": \"0.0\", \"max_bin\": \"256\", \"max_leaves\": \"0\", \"normalize_type\":
      \"tree\", \"objective\": \"reg:linear\", \"one_drop\": \"0\", \"prob_buffer_row\":
      \"1.0\", \"process_type\": \"default\", \"rate_drop\": \"0.0\", \"refresh_leaf\":
      \"1\", \"sample_type\": \"uniform\", \"scale_pos_weight\": \"1.0\", \"silent\":
      \"0\", \"sketch_eps\": \"0.03\", \"skip_drop\": \"0.0\", \"tree_method\": \"auto\",
      \"tweedie_variance_power\": \"1.5\", \"updater\": \"grow_colmaker,prune\"},
      \"stoppingCondition\": {\"maxRuntimeInSeconds\": 3600}}", "name": "training_job_definition",
      "optional": true}, {"name": "training_job_definitions", "optional": true}, {"name":
      "warm_start_config", "optional": true}], "name": "HyperParameterTuningJob"}'}
  labels: {pipelines.kubeflow.org/kfp_sdk_version: 1.8.9}
spec:
  entrypoint: hyperparametertuningjob
  templates:
  - name: hyperparametertuningjob
    inputs:
      parameters:
      - {name: hyper_parameter_tuning_job_config}
      - {name: hyper_parameter_tuning_job_name}
      - {name: tags}
      - {name: training_job_definition}
      - {name: training_job_definitions}
      - {name: warm_start_config}
    dag:
      tasks:
      - name: sagemaker-hyperparametertuningjob
        template: sagemaker-hyperparametertuningjob
        arguments:
          parameters:
          - {name: hyper_parameter_tuning_job_config, value: '{{inputs.parameters.hyper_parameter_tuning_job_config}}'}
          - {name: hyper_parameter_tuning_job_name, value: '{{inputs.parameters.hyper_parameter_tuning_job_name}}'}
          - {name: tags, value: '{{inputs.parameters.tags}}'}
          - {name: training_job_definition, value: '{{inputs.parameters.training_job_definition}}'}
          - {name: training_job_definitions, value: '{{inputs.parameters.training_job_definitions}}'}
          - {name: warm_start_config, value: '{{inputs.parameters.warm_start_config}}'}
  - name: sagemaker-hyperparametertuningjob
    container:
      args: [code_gen/components/HyperParameterTuningJob/src/HyperParameterTuningJob_component.py,
        --hyper_parameter_tuning_job_config, '{{inputs.parameters.hyper_parameter_tuning_job_config}}',
        --hyper_parameter_tuning_job_name, '{{inputs.parameters.hyper_parameter_tuning_job_name}}',
        --tags, '{{inputs.parameters.tags}}', --training_job_definition, '{{inputs.parameters.training_job_definition}}',
        --training_job_definitions, '{{inputs.parameters.training_job_definitions}}',
        --warm_start_config, '{{inputs.parameters.warm_start_config}}']
      command: [python3]
      env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef: {key: AWS_ACCESS_KEY_ID, name: aws-secret}
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef: {key: AWS_SECRET_ACCESS_KEY, name: aws-secret}
      image: rdpen/kfp-component-sagemaker:v2
    inputs:
      parameters:
      - {name: hyper_parameter_tuning_job_config}
      - {name: hyper_parameter_tuning_job_name}
      - {name: tags}
      - {name: training_job_definition}
      - {name: training_job_definitions}
      - {name: warm_start_config}
    outputs:
      artifacts:
      - {name: sagemaker-hyperparametertuningjob-ack_resource_metadata, path: /tmp/outputs/ack_resource_metadata/data}
      - {name: sagemaker-hyperparametertuningjob-best_training_job, path: /tmp/outputs/best_training_job/data}
      - {name: sagemaker-hyperparametertuningjob-conditions, path: /tmp/outputs/conditions/data}
      - {name: sagemaker-hyperparametertuningjob-failure_reason, path: /tmp/outputs/failure_reason/data}
      - {name: sagemaker-hyperparametertuningjob-hyper_parameter_tuning_job_status,
        path: /tmp/outputs/hyper_parameter_tuning_job_status/data}
      - {name: sagemaker-hyperparametertuningjob-overall_best_training_job, path: /tmp/outputs/overall_best_training_job/data}
    metadata:
      labels:
        pipelines.kubeflow.org/kfp_sdk_version: 1.8.9
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
        pipelines.kubeflow.org/enable_caching: "true"
      annotations: {pipelines.kubeflow.org/component_spec: '{"description": "Create
          HyperParameterTuningJob", "implementation": {"container": {"args": ["code_gen/components/HyperParameterTuningJob/src/HyperParameterTuningJob_component.py",
          "--hyper_parameter_tuning_job_config", {"inputValue": "hyper_parameter_tuning_job_config"},
          "--hyper_parameter_tuning_job_name", {"inputValue": "hyper_parameter_tuning_job_name"},
          "--tags", {"inputValue": "tags"}, "--training_job_definition", {"inputValue":
          "training_job_definition"}, "--training_job_definitions", {"inputValue":
          "training_job_definitions"}, "--warm_start_config", {"inputValue": "warm_start_config"}],
          "command": ["python3"], "image": "rdpen/kfp-component-sagemaker:v2"}}, "inputs":
          [{"default": "{}", "description": "The HyperParameterTuningJobConfig object
          that describes the tuning job, including the search strateg", "name": "hyper_parameter_tuning_job_config",
          "type": "JsonObject"}, {"default": "", "description": "The name of the tuning
          job. This name is the prefix for the names of all training jobs that this
          tun", "name": "hyper_parameter_tuning_job_name", "type": "String"}, {"default":
          "[]", "description": "An array of key-value pairs. You can use tags to categorize
          your Amazon Web Services resources in di", "name": "tags", "type": "JsonArray"},
          {"default": "{}", "description": "The HyperParameterTrainingJobDefinition
          object that describes the training jobs that this tuning job", "name": "training_job_definition",
          "type": "JsonObject"}, {"default": "[]", "description": "A list of the HyperParameterTrainingJobDefinition
          objects launched for this tuning job.", "name": "training_job_definitions",
          "type": "JsonArray"}, {"default": "{}", "description": "Specifies the configuration
          for starting the hyperparameter tuning job using one or more previous tu",
          "name": "warm_start_config", "type": "JsonObject"}], "name": "Sagemaker
          - HyperParameterTuningJob", "outputs": [{"description": "All CRs managed
          by ACK have a common `Status.ACKResourceMetadata` member that is used to
          contain res", "name": "ack_resource_metadata", "type": "JsonObject"}, {"description":
          "A TrainingJobSummary object that describes the training job that completed
          with the best current Hyp", "name": "best_training_job", "type": "JsonObject"},
          {"description": "All CRS managed by ACK have a common `Status.Conditions`
          member that contains a collection of `ackv1", "name": "conditions", "type":
          "JsonArray"}, {"description": "If the tuning job failed, the reason it failed.",
          "name": "failure_reason", "type": "String"}, {"description": "The status
          of the tuning job: InProgress, Completed, Failed, Stopping, or Stopped.",
          "name": "hyper_parameter_tuning_job_status", "type": "String"}, {"description":
          "If the hyperparameter tuning job is an warm start tuning job with a WarmStartType
          of IDENTICAL_DATA_", "name": "overall_best_training_job", "type": "JsonObject"}]}',
        pipelines.kubeflow.org/component_ref: '{"digest": "b7b3131bec390d45f17e624883cbedb3f8285b07efd9ee63db28af8a57047aa0",
          "url": "code_gen/components/HyperParameterTuningJob/component.yaml"}', pipelines.kubeflow.org/arguments.parameters: '{"hyper_parameter_tuning_job_config":
          "{{inputs.parameters.hyper_parameter_tuning_job_config}}", "hyper_parameter_tuning_job_name":
          "{{inputs.parameters.hyper_parameter_tuning_job_name}}", "tags": "{{inputs.parameters.tags}}",
          "training_job_definition": "{{inputs.parameters.training_job_definition}}",
          "training_job_definitions": "{{inputs.parameters.training_job_definitions}}",
          "warm_start_config": "{{inputs.parameters.warm_start_config}}"}'}
  arguments:
    parameters:
    - {name: hyper_parameter_tuning_job_config, value: '{"hyperParameterTuningJobObjective":
        {"metricName": "validation:error", "type_": "Minimize"}, "parameterRanges":
        {"categoricalParameterRanges": [], "continuousParameterRanges": [], "integerParameterRanges":
        [{"maxValue": "20", "minValue": "10", "name": "num_round", "scalingType":
        "Linear"}]}, "resourceLimits": {"maxNumberOfTrainingJobs": 2, "maxParallelTrainingJobs":
        1}, "strategy": "Bayesian"}'}
    - {name: hyper_parameter_tuning_job_name, value: kfp-ack-hpo-job-995182}
    - {name: tags}
    - {name: training_job_definition, value: '{"algorithmSpecification": {"trainingImage":
        "632365934929.dkr.ecr.us-west-1.amazonaws.com/xgboost:1", "trainingInputMode":
        "File"}, "enableInterContainerTrafficEncryption": false, "enableNetworkIsolation":
        true, "inputDataConfig": [{"channelName": "train", "compressionType": "None",
        "contentType": "text/libsvm", "dataSource": {"s3DataSource": {"s3DataDistributionType":
        "FullyReplicated", "s3DataType": "S3Prefix", "s3URI": "s3://ack-sagemaker-bucket-402026529871/sagemaker/xgboost/train"}},
        "inputMode": "File", "recordWrapperType": "None"}, {"channelName": "validation",
        "compressionType": "None", "contentType": "text/libsvm", "dataSource": {"s3DataSource":
        {"s3DataDistributionType": "FullyReplicated", "s3DataType": "S3Prefix", "s3URI":
        "s3://ack-sagemaker-bucket-402026529871/sagemaker/xgboost/validation"}}, "inputMode":
        "File", "recordWrapperType": "None"}], "outputDataConfig": {"s3OutputPath":
        "s3://ack-sagemaker-bucket-402026529871"}, "resourceConfig": {"instanceCount":
        1, "instanceType": "ml.m4.xlarge", "volumeSizeInGB": 25}, "roleARN": "arn:aws:iam::402026529871:role/ack-sagemaker-execution-role-402026529871",
        "staticHyperParameters": {"base_score": "0.5", "booster": "gbtree", "csv_weights":
        "0", "dsplit": "row", "grow_policy": "depthwise", "lambda_bias": "0.0", "max_bin":
        "256", "max_leaves": "0", "normalize_type": "tree", "objective": "reg:linear",
        "one_drop": "0", "prob_buffer_row": "1.0", "process_type": "default", "rate_drop":
        "0.0", "refresh_leaf": "1", "sample_type": "uniform", "scale_pos_weight":
        "1.0", "silent": "0", "sketch_eps": "0.03", "skip_drop": "0.0", "tree_method":
        "auto", "tweedie_variance_power": "1.5", "updater": "grow_colmaker,prune"},
        "stoppingCondition": {"maxRuntimeInSeconds": 3600}}'}
    - {name: training_job_definitions}
    - {name: warm_start_config}
  serviceAccountName: pipeline-runner
